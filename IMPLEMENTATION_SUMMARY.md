# –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ Timezone

## üìå –û–±–∑–æ—Ä

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏ –¥–ª—è –±–æ—Ç–∞ **–ö—É–∑—è** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 597 —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1Ô∏è‚É£ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```python
# core/models.py
- Schedule.timezone (–Ω–æ–≤–æ–µ –ø–æ–ª–µ, default="UTC")
- UserSettings (–Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
```

### 2Ô∏è‚É£ –£—Ç–∏–ª–∏—Ç—ã
```python
# core/utils.py
- get_valid_timezones()           # –í—Å–µ 597 –∑–æ–Ω
- is_valid_timezone(tz_name)      # –í–∞–ª–∏–¥–∞—Ü–∏—è
- get_timezone_offset(tz_name)    # UTC offset
- find_timezone_by_keyword(kw)    # –ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥—É
- format_timezone_list()          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### 3Ô∏è‚É£ –ö–æ–º–∞–Ω–¥–∞
```python
# core/handlers.py
@dp.message_created(Command('timezone'))
async def set_timezone(event)
  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
  # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
```

### 4Ô∏è‚É£ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# core/scheduler.py
user_tz = pytz.timezone(sched.timezone)
local_time = now_utc.astimezone(user_tz).time()
# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
/timezone –ú–æ—Å–∫–≤–∞              ‚Üí ‚úÖ Europe/Moscow —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
/timezone America/New_York    ‚Üí ‚úÖ America/New_York —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
/timezone                     ‚Üí ‚è∞ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–æ–Ω—É + —Å–ø—Ä–∞–≤–∫–∞
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```
‚úÖ 5 —Ñ—É–Ω–∫—Ü–∏–π –≤ utils.py
‚úÖ 1 –∫–æ–º–∞–Ω–¥–∞ /timezone
‚úÖ 2 –º–æ–¥–µ–ª–∏ –ë–î (Schedule + UserSettings)
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å scheduler
‚úÖ 597 —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
```

## üìÇ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|---------|
| `core/models.py` | ‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω | +timezone –ø–æ–ª–µ, +UserSettings –º–æ–¥–µ–ª—å |
| `core/utils.py` | ‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω | +5 —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å timezone |
| `core/handlers.py` | ‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω | +–∫–æ–º–∞–Ω–¥–∞ /timezone |
| `core/scheduler.py` | ‚úÖ –°–æ–∑–¥–∞–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç timezone –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π |
| `TIMEZONE.md` | ‚úÖ –°–æ–∑–¥–∞–Ω | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| `test_timezone.py` | ‚úÖ –°–æ–∑–¥–∞–Ω | –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–Ø–∑—ã–∫**: Python 3.13
- **–ë–î**: SQLite/Tortoise ORM
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: pytz (2025.2)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∑–æ–Ω**: 597
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**: –†—É—Å—Å–∫–∏–π

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏: ‚úÖ 5/5 passed
–ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É: ‚úÖ 5/5 passed  
–ü–æ–ª—É—á–µ–Ω–∏–µ UTC offset: ‚úÖ 4/4 passed
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞: ‚úÖ 1/1 passed
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–æ–Ω: 597 –∑–æ–Ω –¥–æ—Å—Ç—É–ø–Ω–æ
```

## üéÅ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ —Ä—É—Å—Å–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏—è–º –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î —á–µ—Ä–µ–∑ `generate_schemas()`.
